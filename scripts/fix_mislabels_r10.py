"""
Fix Mislabeled Training Samples - Round 10
Based on model disagreement analysis (model vs label disagreements)
"""
import json, os, shutil
from datetime import datetime
from collections import Counter

DATA_PATH = "al_rased/data/labeledSamples/training_data.json"
BACKUP_DIR = "al_rased/data/labeledSamples/backups"

FIXES = [
    # ========================================================
    # SECTION 1: Violations â†’ Ø·Ø¨ÙŠØ¹ÙŠ (real student questions)
    # ========================================================
    # [1246] "Ø§ÙŠ Ø§Ø­Ø¯ ØªØ®ØµØµÙ‡ ØªØ±Ø¬Ù…Ø©" â€” asking about a major, not requesting fraud
    (1246, "Ø·Ø¨ÙŠØ¹ÙŠ", ["Ø·Ø¨ÙŠØ¹ÙŠ"],
     "Ø³Ø¤Ø§Ù„ Ø¹Ù† ØªØ®ØµØµ Ø§Ù„ØªØ±Ø¬Ù…Ø© ÙˆÙ…Ø¹Ù„ÙˆÙ…Ø§Øª Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠØ©"),
    # [1326] "Ø§Ø­Ø¯ Ù‚Ø¯ ØªØºÙŠØ¨ Ø¹Ù† Ø§Ø®ØªØ¨Ø§Ø± Ù†Ù‡Ø§Ø¦ÙŠ ÙˆØ±ÙØ¶ÙˆØ§ Ø§Ù„Ø³ÙƒÙ„ÙŠÙ" â€” asking about policy
    (1326, "Ø·Ø¨ÙŠØ¹ÙŠ", ["Ø·Ø¨ÙŠØ¹ÙŠ"],
     "Ø³Ø¤Ø§Ù„ Ø¹Ù† Ø³ÙŠØ§Ø³Ø© Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø³ÙƒÙ„ÙŠÙ Ø¨Ø¹Ø¯ Ø§Ù„ØºÙŠØ§Ø¨"),
    # [1553] "Ø§Ù†Ø§ Ù…Ø§ Ø§Ø³ÙˆÙŠ Ø§Ù†Ø§ Ø¨Ø­Ø§ÙˆÙ„ Ø§Ø´ØºÙ„ Ù‡ÙƒØ± Ù…Ø´ Ø¹Ø§ÙˆØ² Ø§Ø®Ø±Ø¨" â€” explaining not hacking
    (1553, "Ø·Ø¨ÙŠØ¹ÙŠ", ["Ø·Ø¨ÙŠØ¹ÙŠ"],
     "Ø´Ø®Øµ ÙŠÙˆØ¶Ø­ Ø£Ù†Ù‡ Ù„Ø§ ÙŠØ­Ø§ÙˆÙ„ Ø§Ù„ØªØ®Ø±ÙŠØ¨"),
    # [1597] "Ø¬ÙŠØª Ø¨Ø¯ÙØ¹ Ø¹Ù† Ø·Ø±ÙŠÙ‚ Ø¬ÙŠÙ„ Ø¨Ø§ÙŠ" â€” payment issue
    (1597, "Ø·Ø¨ÙŠØ¹ÙŠ", ["Ø·Ø¨ÙŠØ¹ÙŠ"],
     "Ø³Ø¤Ø§Ù„ Ø¹Ù† Ù…Ø´ÙƒÙ„Ø© Ø¯ÙØ¹ Ø¹Ø§Ø¯ÙŠØ©"),
    # [1625] "Ø£Ù†Ø§ Ø®Ø±ÙŠØ¬Ù‡ Ù†Ø²Ù„ÙŠ Ø¬Ø¯ÙˆÙ„ÙŠ ØªÙ…Ø§Ù… Ø¨Ø³ Ø¨Ø§Ù‚ÙŠ Ù…Ø´Ø±ÙˆØ¹ Ø§Ù„ØªØ®Ø±Ø¬" â€” academic planning
    (1625, "Ø·Ø¨ÙŠØ¹ÙŠ", ["Ø·Ø¨ÙŠØ¹ÙŠ"],
     "Ø³Ø¤Ø§Ù„ Ø¹Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆÙ…Ø´Ø±ÙˆØ¹ Ø§Ù„ØªØ®Ø±Ø¬"),
    # [1626] "Ø§Ø­Ø¯ ÙŠØ¹Ø±Ù Ù‚Ø±ÙˆØ¨ ØªØ®ØµØµ Ø¨Ø±Ù…Ø¬Ø©" â€” asking for study group
    (1626, "Ø·Ø¨ÙŠØ¹ÙŠ", ["Ø·Ø¨ÙŠØ¹ÙŠ"],
     "Ø¨Ø­Ø« Ø¹Ù† Ù‚Ø±ÙˆØ¨ Ø¯Ø±Ø§Ø³ÙŠ"),
    # [1631] "Ø§Ø¨ØºÙ‰ Ø§Ù†Ø²Ù„ Ù…Ø¨Ø§Ø¯Ù‰ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠ" â€” course registration
    (1631, "Ø·Ø¨ÙŠØ¹ÙŠ", ["Ø·Ø¨ÙŠØ¹ÙŠ"],
     "Ø³Ø¤Ø§Ù„ Ø¹Ù† ØªØ³Ø¬ÙŠÙ„ Ù…Ø§Ø¯Ø©"),
    # [1702] "Ø§Ø­Ø¯ ÙŠØ¹Ø±Ù Ù‚Ø±ÙˆØ¨ Ø¯ÙƒØªÙˆØ±Ø§Ø© Ø¹Ù„Ù… Ø§Ù„Ù†ÙØ³" â€” looking for group
    (1702, "Ø·Ø¨ÙŠØ¹ÙŠ", ["Ø·Ø¨ÙŠØ¹ÙŠ"],
     "Ø¨Ø­Ø« Ø¹Ù† Ù‚Ø±ÙˆØ¨ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ"),
    # [1707] "Ù…Ø­ØªØ§Ø¬Ù‡ Ù„Ø§Ø¨ØªÙˆØ¨ Ø¹Ù†Ø¯ÙŠ ÙˆØ§Ø¬Ø¨Ø§Øª Ø§Ø¨ÙŠ Ø§ØªØ¯Ø±Ø¨ Ø¹Ù„Ù‰ ÙØ§ÙŠÙ†Ù„ Ø¹Ù…Ù„ÙŠ" â€” needs laptop
    (1707, "Ø·Ø¨ÙŠØ¹ÙŠ", ["Ø·Ø¨ÙŠØ¹ÙŠ"],
     "Ø³Ø¤Ø§Ù„ Ø¹Ù† Ø§Ø­ØªÙŠØ§Ø¬ Ù„Ø§Ø¨ØªÙˆØ¨ Ù„Ù„Ø¯Ø±Ø§Ø³Ø©"),
    # [1911] "ØªÙˆØ§ØµÙ„Øª Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù… Ù…Ø§ ØµÙˆØ±Øª ÙˆØ±ÙØ¹Øª Ø¹Ù„Ù‰ Ø§Ø¹Ø°Ø§Ø± ØºÙŠØ§Ø¨ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±" â€” support question
    (1911, "Ø·Ø¨ÙŠØ¹ÙŠ", ["Ø·Ø¨ÙŠØ¹ÙŠ"],
     "Ø³Ø¤Ø§Ù„ Ø¹Ù† Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø§Ù„Ø£Ø¹Ø°Ø§Ø± Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ"),
    # [1953] "Ø¶Ø§ÙØª Ù„ÙŠ Ù…Ø§Ø¯Ù‡ Ø§Ù„Ø±ÙŠØ§Ø¶Ø§Øª Ø¨Ø¹Ø¯ Ø¨Ø¯Ø§ÙŠÙ‡ Ø§Ù„ØªØ±Ù…" â€” registration issue
    (1953, "Ø·Ø¨ÙŠØ¹ÙŠ", ["Ø·Ø¨ÙŠØ¹ÙŠ"],
     "Ù…Ø´ÙƒÙ„Ø© ØªØ³Ø¬ÙŠÙ„ Ù…Ø§Ø¯Ø©"),
    # [1972] "Ø±ÙØ¹Øª ØªØ°ÙƒØ±Ù‡ Ù…Ù† Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ†" â€” tech support inquiry
    (1972, "Ø·Ø¨ÙŠØ¹ÙŠ", ["Ø·Ø¨ÙŠØ¹ÙŠ"],
     "Ø³Ø¤Ø§Ù„ Ø¹Ù† ØªØ°ÙƒØ±Ø© Ø¯Ø¹Ù… ÙÙ†ÙŠ"),
    # [1975] "Ø§Ø®ØªØ¨Ø±Øª Ù„ÙƒÙ† Ù…Ø§Ù†ÙŠ Ù…ØªØ£ÙƒØ¯Ù‡ Ø§Ø°Ø§ ÙˆØµÙ„ Ø§Ø®ØªØ¨Ø§Ø±ÙŠ" â€” exam concern
    (1975, "Ø·Ø¨ÙŠØ¹ÙŠ", ["Ø·Ø¨ÙŠØ¹ÙŠ"],
     "Ù‚Ù„Ù‚ Ø­ÙˆÙ„ ØªØ³Ù„ÙŠÙ… Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±"),

    # ========================================================
    # SECTION 2: Wrong violation category
    # ========================================================
    # [0722] labeled Ø§Ø­ØªÙŠØ§Ù„ Ù…Ø§Ù„ÙŠ but it's about Ø³ÙƒÙ„ÙŠÙ
    (722, "Ø§Ø­ØªÙŠØ§Ù„ Ø·Ø¨ÙŠ (Ø¹Ø±Ø¶)", ["Ø§Ø­ØªÙŠØ§Ù„ Ø·Ø¨ÙŠ (Ø¹Ø±Ø¶)"],
     "Ø³ÙƒÙ„ÙŠÙ ÙˆØ§Ø¬Ø§Ø²Ù‡ Ù…Ø±Ø¶ÙŠÙ‡ = Ø§Ø­ØªÙŠØ§Ù„ Ø·Ø¨ÙŠ ÙˆÙ„ÙŠØ³ Ù…Ø§Ù„ÙŠ"),
    # [0751] labeled Ø³Ø¨Ø§Ù… but it's investment scam
    (751, "Ø§Ø­ØªÙŠØ§Ù„ Ù…Ø§Ù„ÙŠ (Ø¹Ø±Ø¶)", ["Ø§Ø­ØªÙŠØ§Ù„ Ù…Ø§Ù„ÙŠ (Ø¹Ø±Ø¶)"],
     "Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³Ø§Ù‡Ù…Ø© 3750 Ø±ÙŠØ§Ù„ Ø§Ø³ØªØ«Ù…Ø± = Ø§Ø­ØªÙŠØ§Ù„ Ù…Ø§Ù„ÙŠ"),
    # [0850] labeled Ø³Ø¨Ø§Ù… but it's medical fraud offer
    (850, "Ø§Ø­ØªÙŠØ§Ù„ Ø·Ø¨ÙŠ (Ø¹Ø±Ø¶)", ["Ø§Ø­ØªÙŠØ§Ù„ Ø·Ø¨ÙŠ (Ø¹Ø±Ø¶)"],
     "ØªØ³ÙˆÙŠ Ø³ÙƒÙ„ÙŠÙ ØµØ­ØªÙŠ = Ø§Ø­ØªÙŠØ§Ù„ Ø·Ø¨ÙŠ"),
    # [1343] labeled ØºØ´ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ but it's medical fraud
    (1343, "Ø§Ø­ØªÙŠØ§Ù„ Ø·Ø¨ÙŠ (Ø¹Ø±Ø¶)", ["Ø§Ø­ØªÙŠØ§Ù„ Ø·Ø¨ÙŠ (Ø¹Ø±Ø¶)"],
     "Ø§Ø¹Ø°Ø§Ø± Ø·Ø¨ÙŠØ© Ù…Ù† Ù…Ù†ØµØ© ØµØ­ØªÙŠ = Ø§Ø­ØªÙŠØ§Ù„ Ø·Ø¨ÙŠ"),
    # [1362] labeled Ø³Ø¨Ø§Ù… but it's medical fraud
    (1362, "Ø§Ø­ØªÙŠØ§Ù„ Ø·Ø¨ÙŠ (Ø¹Ø±Ø¶)", ["Ø§Ø­ØªÙŠØ§Ù„ Ø·Ø¨ÙŠ (Ø¹Ø±Ø¶)"],
     "Ø§Ø·Ù„Ø¹ Ø³ÙƒÙ„ÙŠÙ Ø¹Ø°Ø± Ø·Ø¨ÙŠ = Ø§Ø­ØªÙŠØ§Ù„ Ø·Ø¨ÙŠ"),
    # [1871] labeled Ø³Ø¨Ø§Ù… but it's medical fraud
    (1871, "Ø§Ø­ØªÙŠØ§Ù„ Ø·Ø¨ÙŠ (Ø¹Ø±Ø¶)", ["Ø§Ø­ØªÙŠØ§Ù„ Ø·Ø¨ÙŠ (Ø¹Ø±Ø¶)"],
     "Ø¹Ù†Ø¯Ùƒ ØºÙŠØ§Ø¨ Ù†Ø³ÙˆÙŠ Ø³ÙƒÙ„ÙŠÙ = Ø§Ø­ØªÙŠØ§Ù„ Ø·Ø¨ÙŠ"),
    # [2040] labeled Ø³Ø¨Ø§Ù… but it's academic cheating offer
    (2040, "ØºØ´ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ (Ø¹Ø±Ø¶)", ["ØºØ´ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ (Ø¹Ø±Ø¶)"],
     "Ø¨Ø­ÙˆØ«Ø§Øª Ø¹Ù„Ù…ÙŠØ© ÙˆØ§Ø¬Ø¨Ø§Øª = ØºØ´ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ"),
    # [1998] labeled Ø³Ø¨Ø§Ù… but it's medical fraud
    (1998, "Ø§Ø­ØªÙŠØ§Ù„ Ø·Ø¨ÙŠ (Ø¹Ø±Ø¶)", ["Ø§Ø­ØªÙŠØ§Ù„ Ø·Ø¨ÙŠ (Ø¹Ø±Ø¶)"],
     "Ø³ÙƒÙ„ÙŠÙ Ø§Ø¬Ø§Ø²Ø© Ù…Ø±Ø¶ÙŠØ© = Ø§Ø­ØªÙŠØ§Ù„ Ø·Ø¨ÙŠ"),
    # [2048] labeled Ø§Ø­ØªÙŠØ§Ù„ Ø·Ø¨ÙŠ (Ø·Ù„Ø¨) but has phone number = offer
    (2048, "Ø§Ø­ØªÙŠØ§Ù„ Ø·Ø¨ÙŠ (Ø¹Ø±Ø¶)", ["Ø§Ø­ØªÙŠØ§Ù„ Ø·Ø¨ÙŠ (Ø¹Ø±Ø¶)"],
     "Ù…Ù† ÙŠØ¨ÙŠ Ø¹Ø°Ø± + Ø±Ù‚Ù… ØªÙ„ÙÙˆÙ† = Ø¹Ø±Ø¶ ÙˆÙ„ÙŠØ³ Ø·Ù„Ø¨"),
    # [1072] labeled Ø·Ù„Ø¨ but asking HOW = question not request
    (1072, "Ø·Ø¨ÙŠØ¹ÙŠ", ["Ø·Ø¨ÙŠØ¹ÙŠ"],
     "ÙƒÙŠÙ Ø§Ø·Ù„Ø¹ Ø³ÙƒÙ„ÙŠÙ Ù…Ù† ØµØ­ØªÙŠ = Ø³Ø¤Ø§Ù„ Ø¹Ù† ÙƒÙŠÙÙŠØ© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚"),

    # ========================================================
    # SECTION 3: Gray area labels â€” correct category wrong view
    # ========================================================
    # [0145] labeled ØºØ´ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ but is an outdoors/barbecue ad
    (145, "Ø³Ø¨Ø§Ù…", ["Ø³Ø¨Ø§Ù…"],
     "Ø¬Ùˆ Ø§Ù„Ø¨Ø±! Ø¬Ù„Ø³Ø§Øª Ø´Ù‡Ù„Ø© = Ø¥Ø¹Ù„Ø§Ù† Ø±Ø­Ù„Ø§Øª"),
    # [0165] labeled ØºØ´ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ but is phone accessories sale
    (165, "Ø³Ø¨Ø§Ù…", ["Ø³Ø¨Ø§Ù…"],
     "Ø´ÙˆØ§Ø­Ù† ÙˆØ³Ù…Ø§Ø¹Ø§Øª ÙˆØ¨Ø·Ø§Ø±ÙŠØ§Øª = Ø¥Ø¹Ù„Ø§Ù† Ø¨ÙŠØ¹ Ø£Ø¬Ù‡Ø²Ø©"),
    # [0303] labeled ØºØ´ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ but starts with Ø³ÙƒÙ„ÙŠÙ
    (303, "Ø§Ø­ØªÙŠØ§Ù„ Ø·Ø¨ÙŠ (Ø¹Ø±Ø¶)", ["Ø§Ø­ØªÙŠØ§Ù„ Ø·Ø¨ÙŠ (Ø¹Ø±Ø¶)"],
     "Ø³ÙƒÙ„ÙŠÙ Ø§Ø¬Ø§Ø²Ù‡ Ù…Ø±Ø¶ÙŠÙ‡ + ØªÙ‚Ø±ÙŠØ± Ù…Ø±Ø§ÙÙ‚ = Ø§Ø­ØªÙŠØ§Ù„ Ø·Ø¨ÙŠ"),
    # [0489] labeled Ø§Ø­ØªÙŠØ§Ù„ Ù…Ø§Ù„ÙŠ but about raising score
    (489, "Ø³Ø¨Ø§Ù…", ["Ø³Ø¨Ø§Ù…"],
     "ÙŠØ¨ÙŠ ÙŠØ±ÙØ¹ Ø³ÙƒÙˆØ±Ù‡ ÙŠØ¬ÙŠ Ø®Ø§Øµ = Ø³Ø¨Ø§Ù… ØºØ§Ù…Ø¶"),
    # [0521] labeled ØºØ´ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ but crypto referral
    (521, "Ø³Ø¨Ø§Ù…", ["Ø³Ø¨Ø§Ù…"],
     "gate io Ø¨Ø§Ù„ØªØ¯Ø§ÙˆÙ„ 10 ÙƒØ§Ù†Ø¯ÙŠ 20 Ø¯ÙˆÙ„Ø§Ø± = Ø³Ø¨Ø§Ù… ÙƒØ±ÙŠØ¨ØªÙˆ"),
    # [0902] labeled Ø§Ø­ØªÙŠØ§Ù„ Ù…Ø§Ù„ÙŠ but selling Telegram stars
    (902, "Ø³Ø¨Ø§Ù…", ["Ø³Ø¨Ø§Ù…"],
     "Ø´Ø­Ù† Ù†Ø¬ÙˆÙ… ØªÙ„ÙŠØ¬Ø±Ø§Ù… = Ø³Ø¨Ø§Ù… Ø¨ÙŠØ¹"),
    # [0007] labeled ØºØ´ Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠ but is a question
    (7, "Ø·Ø¨ÙŠØ¹ÙŠ", ["Ø·Ø¨ÙŠØ¹ÙŠ"],
     "Ù…Ù† ÙŠØ­Ù„ ÙˆØ§Ø¬Ø¨ Ø§Ù„Ø¹Ø±Ø¨ÙŠ = Ø³Ø¤Ø§Ù„ Ø·Ø§Ù„Ø¨ Ø¹Ù† Ù…Ø³Ø§Ø¹Ø¯Ø©"),
]


def main():
    print("=" * 60)
    print("ðŸ”§ Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø¹ÙŠÙ†Ø§Øª - Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ø¹Ø§Ø´Ø±Ø© (ØªØ­Ù„ÙŠÙ„ ØªØ¹Ø§Ø±Ø¶Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬)")
    print("=" * 60)

    with open(DATA_PATH, "r", encoding="utf-8") as f:
        data = json.load(f)

    print(f"ðŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¹ÙŠÙ†Ø§Øª: {len(data)}")

    os.makedirs(BACKUP_DIR, exist_ok=True)
    ts = datetime.now().strftime("%Y%m%d_%H%M%S")
    backup_path = os.path.join(BACKUP_DIR, f"training_data_pre_fix_r10_{ts}.json")
    shutil.copy2(DATA_PATH, backup_path)
    print(f"ðŸ’¾ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©: {backup_path}")

    before = Counter(d["label"] for d in data)

    fix_count = 0
    for idx, new_label, new_labels, reason in FIXES:
        if idx >= len(data):
            print(f"  âš ï¸ [{idx}] index out of range")
            continue
        sample = data[idx]
        old_label = sample.get("label", "")
        if old_label == new_label:
            continue
        sample["label"] = new_label
        sample["labels"] = new_labels
        sample["note"] = f"Fix R10: {old_label} -> {new_label} ({reason})"
        sample["reviewed_at"] = datetime.now().isoformat()
        sample["reviewed_by"] = "model_disagreement_r10_feb2026"
        fix_count += 1
        print(f"  âœ… [{idx}] {old_label} -> {new_label}")
        print(f"     {reason}")

    with open(DATA_PATH, "w", encoding="utf-8") as f:
        json.dump(data, f, ensure_ascii=False, indent=2)

    after = Counter(d["label"] for d in data)
    print(f"\nðŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø¨Ø¹Ø¯:")
    for k, v in after.most_common():
        diff = v - before.get(k, 0)
        marker = f" ({'+' if diff > 0 else ''}{diff})" if diff != 0 else ""
        print(f"  {k}: {v}{marker}")

    print(f"\nâœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ {fix_count} Ø¹ÙŠÙ†Ø©")


if __name__ == "__main__":
    main()
